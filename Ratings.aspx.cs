using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data;
using System.Data.SqlClient;
using System.Configuration;

public partial class Ratings : System.Web.UI.Page
{
    string str = ConfigurationManager.ConnectionStrings["myconnectionstring"].ConnectionString;
    protected void Page_Load(object sender, EventArgs e)
    {
        label2.Text = Session["username"].ToString();
        label1.Text = Request.QueryString["id"].ToString();
    }
    protected void btn_submit_Click(object sender, EventArgs e)
    {
        SqlConnection con = new SqlConnection(str);
        string check = "select count(*) from T_Rating where Name= '" + label2.Text + "' and Appid='" + label1.Text + "'";
        SqlCommand checkexist = new SqlCommand(check, con);
        con.Open();
        int avil = Convert.ToInt32(checkexist.ExecuteScalar());
        if (avil > 0)
        {
            SqlCommand cmd = new SqlCommand("insert into m_rating(Name,Appid) values('" + label2.Text + "', '" + label1.Text + "')", con);
            cmd.ExecuteNonQuery();
            con.Close();
            lb_error.Visible = true;
            lb_error.Text = "User Rating Already Exists";
}
        else
        {

            lb_rate.Text = Rating1.CurrentRating.ToString();
            SqlCommand cmd = new SqlCommand("insert into T_Rating(Name,Appid,rating_id) values('" + label2.Text + "', '" + label1.Text + "','" + lb_rate.Text + "')", con);
            cmd.ExecuteNonQuery();
            con.Close();
        }
    }
}